(function(e){function t(t){var o=t[0];var a=t[1];var s=t[2];var l,c,f=0,d=[];for(;f<o.length;f++){c=o[f];if(i[c]){d.push(i[c][0])}i[c]=0}for(l in a){if(Object.prototype.hasOwnProperty.call(a,l)){e[l]=a[l]}}if(u)u(t);while(d.length){d.shift()()}r.push.apply(r,s||[]);return n()}function n(){var e;for(var t=0;t<r.length;t++){var n=r[t];var o=true;for(var s=1;s<n.length;s++){var l=n[s];if(i[l]!==0)o=false}if(o){r.splice(t--,1);e=a(a.s=n[0])}}return e}var o={};var i={12:0};var r=[];function a(t){if(o[t]){return o[t].exports}var n=o[t]={i:t,l:false,exports:{}};e[t].call(n.exports,n,n.exports,a);n.l=true;return n.exports}a.m=e;a.c=o;a.d=function(e,t,n){if(!a.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:n})}};a.r=function(e){Object.defineProperty(e,"__esModule",{value:true})};a.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};a.d(t,"a",t);return t};a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};a.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[];var l=s.push.bind(s);s.push=t;s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var u=l;r.push([366,0]);return n()})({321:function(e,t,n){"use strict";(function(e){var o=n(132);function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var r=function e(t,n,o){var i=n(function(){return o.check(undefined)},2e3,false);return{request:function e(t){return t},requestError:function e(n){return t.reject(n)},response:function e(t){return t},responseError:function e(n){i();return t.reject(n)}}};r.$inject=["$q","ngeoDebounce","ngeoNetworkStatus"];r.$inject=["$q","ngeoDebounce","ngeoNetworkStatus"];var a=function(){t.$inject=["$document","$window","$timeout","$rootScope","ngeoOfflineTestUrl"];function t(e,n,o,r,a){i(this,t);this.$document_=e;this.$window_=n;this.$timeout_=o;this.$rootScope_=r;this.ngeoOfflineTestUrl_=a;this.count_=0;this.offline_;this.promise_;this.initialize_()}t.prototype.initialize_=function e(){var t=this;this.offline_=!this.$window_.navigator.onLine;this.$window_.addEventListener("offline",function(){t.triggerChangeStatusEvent_(true)});this.$window_.addEventListener("online",function(){t.check(undefined)});this.$document_.ajaxError(function(e,n,o,i){if(!/^(canceled|abort)$/.test(i)){t.check(2e3)}})};t.prototype.check=function t(n){var o=this;if(this.promise_){this.$timeout_.cancel(this.promise_);this.promise_=undefined}if(n!==undefined){this.count_++;this.promise_=this.$timeout_(function(){return o.check()},n);return}e.ajax({method:"GET",url:this.ngeoOfflineTestUrl_,timeout:1e3,success:function e(){o.count_=0;if(o.offline_){o.triggerChangeStatusEvent_(false)}},error:function e(){o.count_++;if(o.count_>2&&!o.offline_){o.triggerChangeStatusEvent_(true)}}})};t.prototype.triggerChangeStatusEvent_=function e(t){this.offline_=t;this.$rootScope_.$digest()};t.prototype.isDisconnected=function e(){return!!this.offline_};return t}();var s="ngeoNetworkStatus";a.module=angular.module(s,[o["a"].name]);a.module.factory("httpInterceptor",r);a.module.service(s,a);a.module.configFunction_=function(e){e.interceptors.push("httpInterceptor")};a.module.configFunction_.$inject=["$httpProvider"];a.module.config(a.module.configFunction_);a.module.value("ngeoOfflineTestUrl","");var l=a;t["a"]=l}).call(this,n(51))},339:function(e,t,n){"use strict";n.r(t);var o=n(484);var i=n(53);var r=n(19);var a=n(25);var s=n(17);var l=n(35);var c=n(22);var u=n(162);var f=n(259);var d=n(88);var p=n(33);var g=n(74);var h=n(14);var v=n(29);var m=n(21);var y=n(57);function _(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var b=angular.module("ngeoOffline",[u["a"].module.name,f["a"].name]);b.value("ngeoOfflineTemplateUrl",function(e,t){var n=t["ngeoOfflineTemplateurl"];return n!==undefined?n:"ngeo/offline/component.html"});b.run(["$templateCache",function(e){e.put("ngeo/offline/component.html",n(365))}]);w.$inject=["$element","$attrs","ngeoOfflineTemplateUrl"];function w(e,t,n){return n(e,t)}b.component_={bindings:{map:"<ngeoOfflineMap",extentSize:"<?ngeoOfflineExtentsize",maskMargin:"<?ngeoOfflineMaskMargin",minZoom:"<?ngeoOfflineMinZoom",maxZoom:"<?ngeoOfflineMaxZoom"},controller:"ngeoOfflineController",templateUrl:w};b.component("ngeoOffline",b.component_);b.Controller=function(){e.$inject=["$timeout","ngeoFeatureOverlayMgr","ngeoOfflineServiceManager","ngeoOfflineConfiguration","ngeoOfflineMode","ngeoNetworkStatus"];function e(t,n,o,i,r,a){var s=this;_(this,e);this.$timeout_=t;this.ngeoOfflineServiceManager_=o;this.ngeoOfflineConfiguration_=i;this.offlineMode=r;this.networkStatus=a;this.map;this.extentSize;this.featuresOverlay_=n.getFeatureOverlay();this.overlayCollection_=new p["b"];this.featuresOverlay_.setFeatures(this.overlayCollection_);this.postcomposeListener_;this.postComposeListenerKey_=null;this.dataPolygon_=null;this.selectingExtent=false;this.downloading=false;this.progressPercents=0;this.menuDisplayed=false;this.displayAlertAbortDownload=false;this.displayAlertLoadData=false;this.displayAlertNoLayer=false;this.maskMargin;this.minZoom;this.maxZoom;this.originalMinZoom;this.originalMaxZoom;this.estimatedLoadDataSize;this.progressCallback_=function(e){var t=e.detail["progress"];s.progressPercents=Math.floor(t*100);if(t===1){s.finishDownload_()}s.$timeout_(function(){},0)}}e.prototype.$onInit=function e(){this.offlineMode.registerComponent(this);this.postcomposeListener_=this.createMaskPostcompose_();this.ngeoOfflineConfiguration_.on("progress",this.progressCallback_);this.maskMargin=this.maskMargin||100;this.minZoom=this.minZoom||10;this.maxZoom=this.maxZoom||15};e.prototype.$onDestroy=function e(){this.ngeoOfflineConfiguration_.un("progress",this.progressCallback_)};e.prototype.hasData=function e(){return this.ngeoOfflineConfiguration_.hasOfflineData()};e.prototype.computeSizeAndDisplayAlertLoadData=function e(){this.estimatedLoadDataSize=this.ngeoOfflineConfiguration_.estimateLoadDataSize(this.map);if(this.estimatedLoadDataSize>0){this.displayAlertLoadData=true}else{this.displayAlertNoLayer=true}};e.prototype.toggleViewExtentSelection=function e(t){this.menuDisplayed=false;this.selectingExtent=!this.selectingExtent;if(this.postComposeListenerKey_){Object(g["b"])(this.postComposeListenerKey_);this.postComposeListenerKey_=null;this.removeZoomConstraints_()}if(this.selectingExtent&&!this.postComposeListenerKey_){this.addZoomConstraints_();this.postComposeListenerKey_=this.map.on("postcompose",this.postcomposeListener_)}this.map.render()};e.prototype.validateExtent=function e(){this.progressPercents=0;var t=this.getDowloadExtent_();this.ngeoOfflineServiceManager_.save(t,this.map);this.downloading=true};e.prototype.finishDownload_=function e(){this.downloading=false;this.toggleViewExtentSelection(true)};e.prototype.askAbortDownload=function e(){this.displayAlertAbortDownload=true};e.prototype.abortDownload=function e(){this.downloading=false;this.ngeoOfflineServiceManager_.cancel();this.deleteData()};e.prototype.showMenu=function e(){this.menuDisplayed=true};e.prototype.activateOfflineMode=function e(){var t=this;this.ngeoOfflineServiceManager_.restore(this.map).then(function(e){t.dataPolygon_=t.createPolygonFromExtent_(e);var n=t.map.getSize();t.map.getView().fit(e,{size:n});t.menuDisplayed=false;t.displayExtent_();t.offlineMode.enable()})};e.prototype.deactivateOfflineMode=function e(){window.location.reload()};e.prototype.toggleExtentVisibility=function e(){if(this.isExtentVisible()){this.overlayCollection_.clear()}else{this.displayExtent_()}};e.prototype.isExtentVisible=function e(){return this.overlayCollection_.getLength()>0};e.prototype.deleteData=function e(){var t=this;this.overlayCollection_.clear();this.dataPolygon_=null;if(this.networkStatus.isDisconnected()){this.menuDisplayed=false}var n=function e(){if(t.offlineMode.isEnabled()){t.deactivateOfflineMode()}};this.ngeoOfflineConfiguration_.clear().then(n)};e.prototype.displayExtent_=function e(){if(!this.isExtentVisible()){var t=new h["a"](this.dataPolygon_);this.overlayCollection_.push(t)}};e.prototype.addZoomConstraints_=function e(){var t=this.map.getView();var n=t.getZoom();this.originalMinZoom=t.getMinZoom();this.originalMaxZoom=t.getMaxZoom();if(n<this.minZoom){t.setZoom(this.minZoom)}else if(n>this.maxZoom){t.setZoom(this.maxZoom)}t.setMaxZoom(this.maxZoom);t.setMinZoom(this.minZoom)};e.prototype.removeZoomConstraints_=function e(){var t=this.map.getView();t.setMaxZoom(this.originalMaxZoom);t.setMinZoom(this.originalMinZoom)};e.prototype.createMaskPostcompose_=function e(){var t=this;return function(e){var n=e.context;var o=e.frameState;var i=o.viewState.resolution;var r=o.size[0]*o.pixelRatio;var a=o.size[1]*o.pixelRatio;var s=[r/2,a/2];var l=t.extentSize?t.extentSize/i*y["b"]:Math.min(r,a)-t.maskMargin*2;var c=Math.ceil(l/2);n.beginPath();n.moveTo(0,0);n.lineTo(r,0);n.lineTo(r,a);n.lineTo(0,a);n.lineTo(0,0);n.closePath();var u=t.createExtent_(s,c);n.moveTo(u[0],u[1]);n.lineTo(u[0],u[3]);n.lineTo(u[2],u[3]);n.lineTo(u[2],u[1]);n.lineTo(u[0],u[1]);n.closePath();n.fillStyle="rgba(0, 5, 25, 0.5)";n.fill()}};e.prototype.createPolygonFromExtent_=function e(t){var n=this.map.getView().getProjection().getExtent();return new v["b"]([Object(d["b"])(n),Object(d["b"])(t)],m["a"].XY)};e.prototype.createExtent_=function e(t,n){var o=t[0]-n;var i=t[1]-n;var r=t[0]+n;var a=t[1]+n;return[o,i,r,a]};e.prototype.getDowloadExtent_=function e(){var t=this.map.getView().getCenter();var n=Math.ceil(this.extentSize||this.getExtentSize_())/2;return this.createExtent_(t,n)};e.prototype.getExtentSize_=function e(){var t=this.map.getSize();var n=y["b"]*Math.min(t[0],t[1])-this.maskMargin*2;var o=n*this.map.getView().getResolution()/y["b"];return o};return e}();b.controller("ngeoOfflineController",b.Controller);var S=b;var O=n(321);function x(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var M=function(){e.$inject=["$injector"];function e(t){x(this,e);this.$injector_=t;this.saveService_=null;this.restoreService_=null}e.prototype.getOfflineService_=function e(t,n){if(typeof t==="string"){if(!this.$injector_.has(t)){console.error("The offline "+n+" service could not be found");return}var o=this.$injector_.get(t);if(!o[n]){console.error("The offline service "+t+" does not have a "+n+" method");return}return o}if(!t[n]){console.error("The provided offline service does not have a "+n+" method");return}return t};e.prototype.setSaveService=function e(t){this.saveService_=this.getOfflineService_(t,"save")};e.prototype.setRestoreService=function e(t){this.restoreService_=this.getOfflineService_(t,"restore")};e.prototype.cancel=function e(){if(!this.saveService_){console.warn("You must register a saveService first");return}this.saveService_.cancel()};e.prototype.save=function e(t,n){if(!this.saveService_){console.warn("You must register a saveService first");return}this.saveService_.save(t,n)};e.prototype.restore=function e(t){if(!this.restoreService_){console.warn("You must register a restoreService first");return Promise.reject()}return this.restoreService_.restore(t)};return e}();M.module=angular.module("ngeoOfflineServiceManager",[]);M.module.service("ngeoOfflineServiceManager",M);var T=M;var D=n(2);var C=n(96);var $=n(116);function k(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function E(e){return new Promise(function(t,n){var o=new FileReader;o.onload=function(){t(o.result)};o.onerror=n;o.readAsDataURL(e)})}var L=function(){function e(t,n,o){k(this,e);this.maxNumberOfWorkers_=o;this.wasStarted_=false;this.tiles_=t;this.callbacks_=n;this.allCount_=0;this.okCount_=0;this.koCount_=0;this.requestedCount_=0;this.resolvePromise_;this.promise_=null;this.tileIndex_=0;this.cancel_=false}e.prototype.cancel=function e(){this.cancel_=true};e.prototype.downloadTile_=function e(){var t=this;if(this.cancel_||this.tileIndex_>=this.tiles_.length){return}var n=this.tiles_[this.tileIndex_++];var o=n.url;var i=new XMLHttpRequest;i.tileUrl=n.url;i.open("GET",o,true);i.responseType="blob";var r=function e(){if(t.allCount_===t.tiles_.length){t.resolvePromise_()}t.downloadTile_()};var a=function e(n){if(t.cancel_){return}++t.allCount_;++t.koCount_;var o=t.allCount_/t.tiles_.length;t.callbacks_.onTileDownloadError(o).then(r,r)};var s=function e(o){var i=o.target.response;if(i&&i.size!==0){E(i).then(function(e){if(t.cancel_){return}++t.allCount_;++t.okCount_;n.response=e;var o=t.allCount_/t.tiles_.length;t.callbacks_.onTileDownloadSuccess(o,n).then(r,r)},function(){if(t.cancel_){return}a(o)})}else{if(t.cancel_){return}++t.allCount_;++t.okCount_;t.callbacks_.onTileDownloadSuccess(t.allCount_/t.tiles_.length,n).then(r,r)}};i.onload=s;i.onerror=a;i.onabort=a;i.ontimeout=a;i.send();++this.requestedCount_};e.prototype.download=function e(){var t=this;if(this.promise_){return this.promise_}this.promise_=new Promise(function(e,n){t.resolvePromise_=e});D["a"].assert(this.tiles_);for(var n=0;n<this.maxNumberOfWorkers_;++n){this.downloadTile_()}return this.promise_};return e}();var z=L;function A(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function j(e,t){var n=0;for(var o=0;o<e.length;++o){n+=Math.pow(e[1]-t[1],2)}return n}var P=function(){e.$inject=["ngeoOfflineConfiguration"];function e(t){A(this,e);this.configuration_=t;this.tileDownloader_=null}e.prototype.cancel=function e(){this.tileDownloader_.cancel()};e.prototype.queueLayerTiles_=function e(t,n){var o=t.map,i=t.source,r=t.extentByZoom;if(!i){return}D["a"].assert(i instanceof C["a"]||i instanceof $["a"]);var a=o.getView().getProjection();var s=i.getTileGrid();var l=i.getTileUrlFunction();D["a"].assert(r);var c=function e(t){var o=t.zoom;var i=t.extent;var r=[];var c=void 0,u=void 0,f=void 0,d=void 0;s.forEachTileCoord(i,o,function(e){f=e[1];d=e[2];if(c===undefined){c=e[1];u=e[2]}var t=l(e,y["b"],a);D["a"].assert(t);var n={coord:e,url:t};r.push(n)});var p=[o,(c+f)/2,(u+d)/2];r.sort(function(e,t){return j(e.coord,p)-j(t.coord,p)});n.push.apply(n,r)};for(var u=r,f=Array.isArray(u),d=0,u=f?u:u[Symbol.iterator]();;){var p;if(f){if(d>=u.length)break;p=u[d++]}else{d=u.next();if(d.done)break;p=d.value}var g=p;c(g)}};e.prototype.save=function e(t,n){var o=this;var i=this.configuration_.createLayerMetadatas(n,t);var r=[];var a=[];var s=[];for(var l=i,c=Array.isArray(l),u=0,l=c?l:l[Symbol.iterator]();;){var f;if(c){if(u>=l.length)break;f=l[u++]}else{u=l.next();if(u.done)break;f=u.value}var d=f;if(d.layerType==="tile"){var p=[];this.queueLayerTiles_(d,p);a.push.apply(a,p)}r.push({backgroundLayer:d.backgroundLayer,layerType:d.layerType,layerSerialization:d.layerSerialization,key:this.configuration_.getLayerKey(d)});d.extentByZoom.forEach(function(e){var t=e.zoom;if(s.indexOf(t)<0){s.push(t)}})}var g={extent:t,layers:r,zooms:s.sort(function(e,t){return e<t?-1:1})};var h=this.configuration_.setItem("offline_content",g);this.tileDownloader_=new z(a,this.configuration_,this.configuration_.getMaxNumberOfParallelDownloads());var v=this.tileDownloader_.download();var m=Promise.all([h,v]);var y=function e(){return o.configuration_.setHasOfflineData(true)};m.then(y,y);return m};return e}();var Z="offlineDownloader";P.module=angular.module(Z,[]).service(Z,P);var I=P;var N=I;var R=n(270);function W(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var V=function(){e.$inject=["ngeoOfflineConfiguration","ngeoBackgroundLayerMgr"];function e(t,n){W(this,e);this.configuration_=t;this.ngeoBackgroundLayerMgr_=n}e.prototype.restore=function e(t){var n=this;return this.configuration_.getItem("offline_content").then(function(e){return n.doRestore(t,e)})};e.prototype.doRestore=function e(t,n){t.getLayerGroup().getLayers().clear();for(var o=n.layers,i=Array.isArray(o),r=0,o=i?o:o[Symbol.iterator]();;){var a;if(i){if(r>=o.length)break;a=o[r++]}else{r=o.next();if(r.done)break;a=r.value}var s=a;var l=this.configuration_.recreateOfflineLayer(s);if(l){t.addLayer(l);if(s.backgroundLayer){this.ngeoBackgroundLayerMgr_.set(t,l)}}}return n.extent};return e}();var G="ngeoOfflineRestorer";V.module=angular.module(G,[R["a"].module.name]).service(G,V);var U=V;var B=U;function F(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var J=function(){e.$inject=["ngeoOfflineConfiguration"];function e(t){F(this,e);this.enabled_=false;this.component_;this.ngeoOfflineConfiguration_=t}e.prototype.isEnabled=function e(){return this.enabled_};e.prototype.enable=function e(){this.enabled_=true};e.prototype.registerComponent=function e(t){this.component_=t};e.prototype.activateOfflineMode=function e(){this.component_.activateOfflineMode()};e.prototype.hasData=function e(){return this.ngeoOfflineConfiguration_.hasOfflineData()};return e}();J.module=angular.module("ngeoOfflineMode",[]);J.module.service("ngeoOfflineMode",J);var q=J;var K=angular.module("ngeoOfflineModule",[S.name,O["a"].module.name,T.module.name,N.module.name,B.module.name,q.module.name]);K.value("ngeoOfflineGutter",96);var H=K;var Y=n(77);var Q=n(38);var X=n(76);var ee=n(7);var te=n(165);var ne=n(71);var oe=n(166);var ie=n(194);var re=n(186);var ae=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function se(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var le=function(){function e(t){var n=t.gutter;se(this,e);this.gutter_=n}e.prototype.createBaseObject_=function e(t){var n=t.getProperties();var o={};for(var i in n){var r=n[i];var a=typeof r==="undefined"?"undefined":ae(r);if(a==="string"||a==="number"){o[i]=r}}return o};e.prototype.serializeTilegrid=function e(t){var n={};n["extent"]=t.getExtent();n["minZoom"]=t.getMinZoom();n["origin"]=t.getOrigin(0);n["resolutions"]=t.getResolutions();n["tileSize"]=t.getTileSize(t.getMinZoom());return JSON.stringify(n)};e.prototype.deserializeTilegrid=function e(t){var n=JSON.parse(t);return new ie["a"](n)};e.prototype.serializeTilegridWMTS=function e(t){if(!t){return undefined}var n={};var o=t.getResolutions();n["extent"]=t.getExtent();n["minZoom"]=t.getMinZoom();n["matrixIds"]=t.getMatrixIds();n["resolutions"]=o;n["origins"]=[];for(var i=0;i<o.length;++i){n["origins"].push(t.getOrigin(i))}return JSON.stringify(n)};e.prototype.deserializeTilegridWMTS=function e(t){var n=JSON.parse(t);return new re["b"](n)};e.prototype.serializeSourceTileWMS=function e(t){var n=this.createBaseObject_(t);n["params"]=t.getParams();n["urls"]=t.getUrls();n["tileGrid"]=this.serializeTilegrid(t.getTileGrid());var o=t.getProjection();if(o){n["projection"]=ee["h"](t.getProjection()).getCode()}return JSON.stringify(n)};e.prototype.deserializeSourceTileWMS=function e(t,n){var o=JSON.parse(t);o["tileLoadFunction"]=n;if(o["tileGrid"]){o["tileGrid"]=this.deserializeTilegrid(o["tileGrid"])}o["gutter"]=this.gutter_;return new C["a"](o)};e.prototype.serializeSourceWMTS=function e(t){var n=this.createBaseObject_(t);n["dimensions"]=t.getDimensions();n["format"]=t.getFormat();n["urls"]=t.getUrls();n["version"]=t.getVersion();n["layer"]=t.getLayer();n["style"]=t.getStyle();n["matrixSet"]=t.getMatrixSet();var o=t.getTileGrid();n["tileGrid"]=this.serializeTilegridWMTS(o);n["requestEncoding"]=t.getRequestEncoding();var i=t.getProjection();if(i){n["projection"]=ee["h"](t.getProjection()).getCode()}return JSON.stringify(n)};e.prototype.deserializeSourceWMTS=function e(t,n){var o=JSON.parse(t);o["tileLoadFunction"]=n;if(o["tileGrid"]){o["tileGrid"]=this.deserializeTilegridWMTS(o["tileGrid"])}return new $["a"](o)};e.prototype.makeInfinitySerializable_=function e(t){if(t===Infinity){return 1e3}return t};e.prototype.serializeTileLayer=function e(t,n){var o=this.createBaseObject_(t);o["opacity"]=t.getOpacity();o["visible"]=t.getVisible();o["minResolution"]=t.getMinResolution();o["maxResolution"]=this.makeInfinitySerializable_(t.getMaxResolution());o["zIndex"]=t.getZIndex();n=n||t.getSource();if(n instanceof C["a"]){o["source"]=this.serializeSourceTileWMS(n);o["sourceType"]="tileWMS"}else if(n instanceof $["a"]){o["source"]=this.serializeSourceWMTS(n);o["sourceType"]="WMTS"}return JSON.stringify(o)};e.prototype.deserializeTileLayer=function e(t,n){var o=JSON.parse(t);var i=o["sourceType"];if(i==="tileWMS"){o["source"]=this.deserializeSourceTileWMS(o["source"],n)}else if(i==="WMTS"){o["source"]=this.deserializeSourceWMTS(o["source"],n)}return new s["a"](o)};return e}();var ce=le;var ue=ce;var fe=n(85);var de=n(83);var pe={};pe.traverseLayer=function(e,t,n){var o=n(e,t);if(o&&e instanceof de["a"]){e.getLayers().forEach(function(o){pe.traverseLayer(o,[].concat(t,[e]),n)})}};var ge=new RegExp("[^/]*//[^/]+/(.*)");pe.normalizeURL=function(e){var t=e.match(ge);return t[1]};var he=pe;var ve=n(248);function me(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function ye(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function _e(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var be=te["a"].defaultImageLoadFunction;var we=function(e){t.$inject=["$rootScope","ngeoBackgroundLayerMgr","ngeoOfflineGutter"];_e(t,e);function t(n,o,i){me(this,t);var r=ye(this,e.call(this));ve["config"]({name:"ngeoOfflineStorage",version:1,storeName:"offlineStorage"});r.dispatchProgress_=function(e){r.dispatchEvent(new fe["a"]("progress",{progress:e}))};r.rootScope_=n;r.hasData=false;r.initializeHasOfflineData();r.ngeoBackgroundLayerMgr_=o;r.serDes_=new ue({gutter:i});r.gutter_=i;return r}t.prototype.initializeHasOfflineData=function e(){var t=this;this.getItem("offline_content").then(function(e){return t.setHasOfflineData(!!e)})};t.prototype.hasOfflineData=function e(){return this.hasData};t.prototype.setHasOfflineData=function e(t){var n=t^this.hasData;this.hasData=t;if(n){this.rootScope_.$applyAsync()}};t.prototype.traceGetSetItem=function e(t,n,o){return o};t.prototype.getItem=function e(t){return this.traceGetSetItem("getItem",t,ve["getItem"](t))};t.prototype.setItem=function e(t,n){return this.traceGetSetItem("setItem",t,ve["setItem"](t,n))};t.prototype.clear=function e(){this.setHasOfflineData(false);return this.traceGetSetItem("clear","",ve["clear"]())};t.prototype.estimateLoadDataSize=function e(t){return 50};t.prototype.getLayerKey=function e(t){return t.layer.get("label")};t.prototype.onTileDownloadSuccess=function e(t,n){this.dispatchProgress_(t);if(n.response){return this.setItem(he.normalizeURL(n.url),n.response)}return Promise.resolve()};t.prototype.onTileDownloadError=function e(t){this.dispatchProgress_(t);return Promise.resolve()};t.prototype.getExtentByZoom=function e(t,n,o,i){var r=t.getView().getZoom();var a=[];[0,1,2,3,4].forEach(function(e){a.push({zoom:r+e,extent:i})});return a};t.prototype.sourceImageWMSToTileWMS=function e(t,n){if(t instanceof ne["a"]&&t.getUrl()&&t.getImageLoadFunction()===be){var o=Object(oe["a"])(t.getProjection()||n,42,256);t=new C["a"]({gutter:this.gutter_,url:t.getUrl(),tileGrid:o,attributions:t.getAttributions(),projection:t.getProjection(),params:t.getParams()})}return t};t.prototype.createLayerMetadatas=function e(t,n){var o=this;var i=[];var r=function e(r,a){if(r instanceof Y["a"]){var l=o.getExtentByZoom(t,r,a,n);var c=ee["h"](t.getView().getProjection());var u=o.sourceImageWMSToTileWMS(r.getSource(),c);var f=void 0;var d=void 0;if(r instanceof s["a"]||r instanceof X["a"]){f="tile";d=o.serDes_.serializeTileLayer(r,u)}else if(r instanceof Q["a"]){f="vector"}var p=o.ngeoBackgroundLayerMgr_.get(t)===r;i.push({backgroundLayer:p,map:t,extentByZoom:l,layerType:f,layerSerialization:d,layer:r,source:u,ancestors:a})}return true};t.getLayers().forEach(function(e){he.traverseLayer(e,[],r)});return i};t.prototype.createTileLoadFunction_=function e(t){var n=this;var o=function e(t,o){n.getItem(he.normalizeURL(o)).then(function(e){if(!e){e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="}t.getImage().src=e})};return o};t.prototype.recreateOfflineLayer=function e(t){if(t.layerType==="tile"){var n=t.layerSerialization;var o=this.createTileLoadFunction_(t);var i=this.serDes_.deserializeTileLayer(n,o);return i}return null};t.prototype.getMaxNumberOfParallelDownloads=function e(){return 11};return t}(g["a"]);var Se=we;var Oe=n(308);var xe=n(310);var Me=n(300);function Te(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var De={};De.module=angular.module("app",["gettext",c["a"].name,H.name,T.module.name]);De.module.value("ngeoOfflineTestUrl","../../src/offline/component.html");H.service("ngeoOfflineConfiguration",Se);var Ce=function e(t,n,o){Te(this,e);this.offlineExtentSize=1e4;this.ngeoNetworkStatus=n;this.map=new r["a"]({layers:[new s["a"]({source:new l["b"]})],view:new a["a"]({center:[352379,5172733],zoom:4})});t.init(this.map);o.setSaveService("offlineDownloader");o.setRestoreService("ngeoOfflineRestorer")};Ce.$inject=["ngeoFeatureOverlayMgr","ngeoNetworkStatus","ngeoOfflineServiceManager"];Ce.$inject=["ngeoFeatureOverlayMgr","ngeoNetworkStatus","ngeoOfflineServiceManager"];De.module.controller("MainController",Ce);var $e=t["default"]=De},365:function(e,t){e.exports='<div class=main-button> <span ng-if=!$ctrl.hasData()> <div class=no-data ng-click=$ctrl.toggleViewExtentSelection()></div> </span> <span ng-if=$ctrl.hasData()> <div class=with-data ng-click=$ctrl.showMenu()></div> </span> </div> <div ng-if="$ctrl.selectingExtent && !$ctrl.networkStatus.isDisconnected()" class="validate-extent btn btn-primary"> <div ng-if=!$ctrl.downloading ng-click=$ctrl.computeSizeAndDisplayAlertLoadData() translate>Save map</div> <div ng-if=$ctrl.downloading ng-click=$ctrl.askAbortDownload() translate>Abort</div> </div> <div ng-if=$ctrl.downloading class=in-progress> <div>{{$ctrl.progressPercents}}%</div> </div> <ngeo-modal ng-model=$ctrl.menuDisplayed> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title translate>Offline map</h4> </div> <div class=modal-body> <div ng-if=$ctrl.hasData()> <button type=button class="extent-zoom btn btn-default" ng-if=!$ctrl.offlineMode.isEnabled() ng-click=$ctrl.activateOfflineMode() translate>Activate offline mode </button> <button type=button class="extent-zoom btn btn-default" ng-if="$ctrl.offlineMode.isEnabled() && !$ctrl.networkStatus.isDisconnected()" ng-click=$ctrl.deactivateOfflineMode() translate>Deactivate offline mode </button> <button type=button class="extent-show btn btn-default" ng-if=$ctrl.offlineMode.isEnabled() ng-click=$ctrl.toggleExtentVisibility()> <span ng-if=$ctrl.isExtentVisible() translate>Hide extent</span> <span ng-if=!$ctrl.isExtentVisible() translate>Show extent</span> </button> <button type=button class="delete btn btn-default" ng-if=!$ctrl.networkStatus.isDisconnected() ng-click="$ctrl.displayAlertDestroyData = true" translate>Delete data </button> </div> <div ng-if="!$ctrl.hasData() && !$ctrl.networkStatus.isDisconnected()"> <button type=button class="new-data btn btn-default" ng-click=$ctrl.toggleViewExtentSelection() translate>Save new map </button> </div> </div> </ngeo-modal> <ngeo-modal ng-model=$ctrl.displayAlertLoadData> <div class=modal-header> <h4 class=modal-title translate>Warning</h4> </div> <div class=modal-body> <p translate>~{{$ctrl.estimatedLoadDataSize}}MB of maps will be downloaded (until scale 1:25\'000) - Don\'t lock your device or navigate away from this site during the download process. Deactivate "private" mode of your browser.</p> <button type=button class="validate btn btn-primary" data-dismiss=modal ng-click=$ctrl.validateExtent() translate>Ok </button> <button type=button class="delete btn btn-default" data-dismiss=modal translate>Cancel </button> </div> </ngeo-modal> <ngeo-modal ng-model=$ctrl.displayAlertNoLayer> <div class=modal-header> <h4 class=modal-title translate>Warning</h4> </div> <div class=modal-body> <p translate>No maps selected for saving.</p> <button type=button class="delete btn btn-default" data-dismiss=modal translate>Ok </button> </div> </ngeo-modal> <ngeo-modal ng-model=$ctrl.displayAlertDestroyData> <div class=modal-header> <h4 class=modal-title translate>Warning</h4> </div> <div class=modal-body> <p translate>Do you really want to remove your data ?</p> <button type=button class="validate btn btn-primary" data-dismiss=modal ng-click=$ctrl.deleteData() translate>Ok </button> <button type=button class="delete btn btn-default" data-dismiss=modal translate>Cancel </button> </div> </ngeo-modal> <ngeo-modal ng-model=$ctrl.displayAlertAbortDownload> <div class=modal-header> <h4 class=modal-title translate>Warning</h4> </div> <div class=modal-body> <p translate>Do you really want to remove your data ?</p> <button type=button class="validate btn btn-primary" data-dismiss=modal ng-click=$ctrl.abortDownload() translate>Ok </button> <button type=button class="delete btn btn-default" data-dismiss=modal ng-click=$ctrl.followDownloadProgression_() translate>Cancel </button> </div> </ngeo-modal> '},366:function(e,t,n){n(53);n(55);e.exports=n(339)},484:function(e,t){}});
//# sourceMappingURL=offline.dbb1eb.js.map